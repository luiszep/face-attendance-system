<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Employee Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-900 min-h-screen">

  <!-- Top Header Bar -->
  <header class="w-full bg-gray-900 text-white px-8 py-4 flex justify-between items-center shadow">
    <div class="text-2xl font-black tracking-tight">FACIAL RECOGNITION</div>
    <div class="flex items-center space-x-4">
      <span class="bg-gray-800 px-4 py-1 rounded-full font-mono text-sm">ID: {{ current_user.id }}</span>
      <form action="{{ url_for('auth_bp.logout') }}" method="post" class="inline">
        <button class="bg-red-600 hover:bg-red-700 px-4 py-1 rounded-full font-semibold shadow transition">
          Logout
        </button>
      </form>
    </div>
  </header>

  <!-- Tab Bar (adapted from JSX version) -->
  <div class="w-full bg-white border-b border-gray-200 flex px-8">
    <nav class="flex space-x-6 w-full">
      <a href="{{ url_for('admin_bp.data') }}"
         class="uppercase tracking-wide px-4 py-3 font-semibold text-sm border-b-4 transition-colors
         {% if active_tab == 'employee' %}
           border-pink-500 text-pink-600
         {% else %}
           border-transparent text-gray-500 hover:text-pink-400
         {% endif %}">
        Employee Database
      </a>
      <a href="{{ url_for('admin_bp.weekly_attendance') }}"
         class="uppercase tracking-wide px-4 py-3 font-semibold text-sm border-b-4 transition-colors
         {% if active_tab == 'weekly' %}
           border-pink-500 text-pink-600
         {% else %}
           border-transparent text-gray-500 hover:text-pink-400
         {% endif %}">
        Weekly Attendance
      </a>
      <a href="{{ url_for('admin_bp.custom_query') }}"
         class="uppercase tracking-wide px-4 py-3 font-semibold text-sm border-b-4 transition-colors
         {% if active_tab == 'query' %}
           border-pink-500 text-pink-600
         {% else %}
           border-transparent text-gray-500 hover:text-pink-400
         {% endif %}">
        Custom Query
      </a>
    </nav>
  </div>

  <!-- Page Container -->
  <div class="max-w-4xl mx-auto px-6 py-10">

    <!-- Tab Content: Employee Database -->
    <div id="employee-db" class="tab-content active bg-white p-8 rounded-xl shadow text-gray-900">
      <h2 class="text-2xl font-bold mb-6 text-center">Add Employee</h2>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <ul class="mb-4 text-sm text-yellow-700">
            {% for message in messages %}
              <li>{{ message }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <form action="/Attendance_system/add_user" method="post" enctype="multipart/form-data" class="space-y-4">
        <!-- Form fields (unchanged) -->
        <div>
          <label for="first_name" class="block text-sm font-medium mb-1">First Name:</label>
          <input type="text" id="first_name" name="first_name" class="w-full px-4 py-2 border border-gray-300 rounded-md" />
        </div>
        <div>
          <label for="last_name" class="block text-sm font-medium mb-1">Last Name:</label>
          <input type="text" id="last_name" name="last_name" class="w-full px-4 py-2 border border-gray-300 rounded-md" />
        </div>
        <div>
          <label for="occupation" class="block text-sm font-medium mb-1">Occupation:</label>
          <input type="text" id="occupation" name="occupation" class="w-full px-4 py-2 border border-gray-300 rounded-md" />
        </div>
        <div>
          <label for="regular_wage" class="block text-sm font-medium mb-1">Regular Hourly Wage:</label>
          <input type="number" step="0.01" id="regular_wage" name="regular_wage" class="w-full px-4 py-2 border border-gray-300 rounded-md" />
        </div>
        <div>
          <label for="overtime_wage" class="block text-sm font-medium mb-1">Overtime Hourly Wage:</label>
          <input type="number" step="0.01" id="overtime_wage" name="overtime_wage" class="w-full px-4 py-2 border border-gray-300 rounded-md" />
        </div>
        <div>
          <label for="regular_hours" class="block text-sm font-medium mb-1">Regular Hours Per Day:</label>
          <input type="number" id="regular_hours" name="regular_hours" class="w-full px-4 py-2 border border-gray-300 rounded-md" />
        </div>
        <div>
          <label for="maximum_overtime_hours" class="block text-sm font-medium mb-1">Maximum Overtime Hours Per Day:</label>
          <input type="number" id="maximum_overtime_hours" name="maximum_overtime_hours" class="w-full px-4 py-2 border border-gray-300 rounded-md" />
        </div>
        <div>
          <label for="reg_id" class="block text-sm font-medium mb-1">Register ID:</label>
          <input type="text" id="reg_id" name="reg_id" class="w-full px-4 py-2 border border-gray-300 rounded-md" />
        </div>
        <div>
          <label for="image" class="block text-sm font-medium mb-1">Upload Image:</label>
          <input type="file" id="image" name="image" accept=".jpg" class="w-full px-4 py-2 border border-gray-300 bg-white rounded-md" />
          <p id="imageError" class="text-xs text-red-600 mt-1 hidden">Filename must match Register ID in UPPERCASE and end with ".jpg".</p>
          <p class="text-xs text-gray-500 mt-1">Example: If Register ID is "employee1", filename must be "EMPLOYEE1.jpg".</p>
        </div>
        <div>
          <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-md font-semibold transition-all duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed">
            Submit
          </button>
        </div>
      </form>

      <div class="mt-4 text-center">
        <a href="/Attendance_system/images" onclick="reloadPage()" class="text-blue-600 underline hover:text-blue-800 text-sm">View Uploaded Images</a>
      </div>
    </div>

    <!-- Other Tabs -->
    <div id="weekly-attendance" class="tab-content bg-white p-8 rounded-xl shadow text-gray-700 mt-6">
      <h2 class="text-2xl font-bold mb-4 text-center">Weekly Attendance (Coming Soon)</h2>
      <p class="text-center text-gray-500">This section will display a weekly view of employee attendance.</p>
    </div>

    <div id="custom-query" class="tab-content bg-white p-8 rounded-xl shadow text-gray-700 mt-6">
      <h2 class="text-2xl font-bold mb-4 text-center">Custom Query (Coming Soon)</h2>
      <p class="text-center text-gray-500">This section will support advanced filtering of attendance and employee records.</p>
    </div>
  </div>

  <!-- Tab Scripts & Validation -->
  <script>
    function reloadPage() { location.reload(); }

    const regIdInput = document.getElementById('reg_id');
    const imageInput = document.getElementById('image');
    const imageError = document.getElementById('imageError');
    const submitBtn = document.getElementById('submitBtn');

    function validateImageFilename() {
      const regId = regIdInput.value.trim();
      const file = imageInput.files[0];
      if (!regId || !file) {
        imageError.classList.add('hidden');
        submitBtn.disabled = true;
        return;
      }

      const expected = `${regId.toUpperCase()}.jpg`;
      const actual = file.name;

      if (actual === expected) {
        imageError.classList.add('hidden');
        submitBtn.disabled = false;
      } else {
        imageError.classList.remove('hidden');
        submitBtn.disabled = true;
      }
    }

    regIdInput.addEventListener('input', validateImageFilename);
    imageInput.addEventListener('change', validateImageFilename);
  </script>

  {% if error %}
    <script>alert("{{ error|safe }}");</script>
  {% endif %}

</body>
</html>
