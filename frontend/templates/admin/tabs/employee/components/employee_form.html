<!-- Modern Employee ID Card Form -->
<div class="max-w-6xl mx-auto bg-gray-900 rounded-2xl shadow-2xl overflow-hidden mb-8 border-4 border-green-400 neon-border">
  <!-- Header -->
  <div class="bg-gradient-to-r from-green-600 to-green-700 px-8 py-6">
    <div class="flex items-center space-x-3">
      <div class="bg-white/20 rounded-full p-2">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
      </div>
      <h2 class="text-2xl font-bold text-white">Create New Employee ID</h2>
    </div>
  </div>

  <!-- Form Content -->
  <form action="{{ url_for('admin_bp.add_user') }}" method="post" enctype="multipart/form-data" class="p-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- ID Card Preview Section -->
      <div class="lg:col-span-1">
        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border-2 border-dashed border-green-500/30 hover:border-green-400 transition-colors ">
          <h3 class="text-lg font-semibold text-white mb-4 text-center">Employee Photo</h3>
          
          <!-- Photo Upload Area -->
          <div class="relative group">
            <div id="photoPreview" class="w-full h-64 bg-gray-700 rounded-lg border-2 border-green-500/30 flex items-center justify-center cursor-pointer hover:bg-gray-600/50 transition-colors ">
              <div class="text-center">
                <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                <p class="text-sm text-gray-300">Click to upload photo</p>
                <p class="text-xs text-gray-400 mt-1">JPG format only</p>
              </div>
            </div>
            <input type="file" id="image" name="image" accept=".jpg" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
          </div>
          
          <!-- Photo Instructions -->
          <div class="mt-4 p-3 bg-green-900/30 border border-green-500/30 rounded-lg ">
            <p class="text-xs text-green-400 font-medium">üìù Important:</p>
            <p class="text-xs text-green-300 mt-1">Filename must match Register ID in UPPERCASE and end with ".jpg"</p>
            <p class="text-xs text-green-200 mt-1 italic">Example: EMPLOYEE1.jpg</p>
          </div>
          <p id="imageError" class="text-xs text-red-400 mt-2 hidden bg-red-900/30 border border-red-500/30 p-2 rounded ">Filename must match Register ID in UPPERCASE and end with ".jpg".</p>
        </div>
      </div>

      <!-- Form Fields Section -->
      <div class="lg:col-span-2">
        <div class="space-y-6">
          
          <!-- Personal Information -->
          <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-green-500/20 ">
            <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
              <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Personal Information
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="form-group">
                <label for="first_name" class="block text-sm font-medium text-gray-300 mb-2">First Name</label>
                <input type="text" id="first_name" name="first_name" required maxlength="80"
                       class="w-full px-4 py-3 border border-green-500/30 rounded-lg text-sm bg-gray-700 text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors " 
                       placeholder="Enter first name" />
                <p class="text-xs text-gray-400 mt-1">Maximum 80 characters</p>
              </div>
              <div class="form-group">
                <label for="last_name" class="block text-sm font-medium text-gray-300 mb-2">Last Name</label>
                <input type="text" id="last_name" name="last_name" required maxlength="80"
                       class="w-full px-4 py-3 border border-green-500/30 rounded-lg text-sm bg-gray-700 text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" 
                       placeholder="Enter last name" />
                <p class="text-xs text-gray-400 mt-1">Maximum 80 characters</p>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
              <div class="form-group">
                <label for="occupation" class="block text-sm font-medium text-gray-300 mb-2">Job Title</label>
                <input type="text" id="occupation" name="occupation" required maxlength="80"
                       class="w-full px-4 py-3 border border-green-500/30 rounded-lg text-sm bg-gray-700 text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" 
                       placeholder="e.g., Software Engineer" />
                <p class="text-xs text-gray-400 mt-1">Maximum 80 characters</p>
              </div>
              <div class="form-group">
                <label for="reg_id" class="block text-sm font-medium text-gray-300 mb-2">Employee ID</label>
                <input type="text" id="reg_id" name="reg_id" required maxlength="80"
                       class="w-full px-4 py-3 border border-green-500/30 rounded-lg text-sm bg-gray-700 text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" 
                       placeholder="e.g., EMP001" />
                <p class="text-xs text-gray-400 mt-1">Maximum 80 characters</p>
              </div>
            </div>
          </div>

          <!-- Compensation Details -->
          <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-green-500/20 ">
            <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
              <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
              </svg>
              Compensation & Hours
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="form-group">
                <label for="regular_wage" class="block text-sm font-medium text-gray-300 mb-2">Regular Hourly Rate</label>
                <div class="relative">
                  <span class="absolute left-3 top-3 text-gray-500">$</span>
                  <input type="number" step="0.01" min="0.01" max="999.99" id="regular_wage" name="regular_wage" required 
                         class="w-full pl-8 pr-4 py-3 border border-green-500/30 rounded-lg text-sm bg-gray-700 text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" 
                         placeholder="0.00" />
                </div>
                <p class="text-xs text-gray-400 mt-1">$0.01 - $999.99 per hour</p>
              </div>
              <div class="form-group">
                <label for="overtime_wage" class="block text-sm font-medium text-gray-300 mb-2">Overtime Hourly Rate</label>
                <div class="relative">
                  <span class="absolute left-3 top-3 text-gray-500">$</span>
                  <input type="number" step="0.01" min="0.01" max="999.99" id="overtime_wage" name="overtime_wage" required 
                         class="w-full pl-8 pr-4 py-3 border border-green-500/30 rounded-lg text-sm bg-gray-700 text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" 
                         placeholder="0.00" />
                </div>
                <p class="text-xs text-gray-400 mt-1">$0.01 - $999.99 per hour</p>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
              <div class="form-group">
                <label for="regular_hours" class="block text-sm font-medium text-gray-300 mb-2">Regular Hours/Day</label>
                <input type="number" min="1" max="24" id="regular_hours" name="regular_hours" required 
                       class="w-full px-4 py-3 border border-green-500/30 rounded-lg text-sm bg-gray-700 text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" 
                       placeholder="8" />
                <p class="text-xs text-gray-400 mt-1">1 - 24 hours per day</p>
              </div>
              <div class="form-group">
                <label for="maximum_overtime_hours" class="block text-sm font-medium text-gray-300 mb-2">Max Overtime Hours/Day</label>
                <input type="number" min="0" max="24" id="maximum_overtime_hours" name="maximum_overtime_hours" 
                       class="w-full px-4 py-3 border border-green-500/30 rounded-lg text-sm bg-gray-700 text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" 
                       placeholder="4" />
                <p class="text-xs text-gray-400 mt-1">0 - 24 hours per day (optional)</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="mt-8 text-center">
      <button type="submit" id="submitBtn" 
              class="inline-flex items-center px-8 py-4 bg-green-500 hover:bg-green-600 text-black font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none neon-border">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
        Create Employee Profile
      </button>
    </div>
  </form>
</div>

<!-- Enhanced JavaScript for Image Preview -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.getElementById('image');
    const photoPreview = document.getElementById('photoPreview');
    const regIdInput = document.getElementById('reg_id');
    const imageError = document.getElementById('imageError');

    // Image preview functionality
    imageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                photoPreview.innerHTML = `
                    <div class="relative w-full h-full">
                        <img src="${e.target.result}" alt="Employee Photo" class="w-full h-full object-cover rounded-lg">
                        <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-10 transition-all rounded-lg flex items-center justify-center">
                            <span class="text-white opacity-0 hover:opacity-100 transition-opacity">Click to change</span>
                        </div>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
            
            // Validate filename
            validateImageFilename(file.name, regIdInput.value);
        }
    });

    // Real-time filename validation
    regIdInput.addEventListener('input', function() {
        if (imageInput.files[0]) {
            validateImageFilename(imageInput.files[0].name, this.value);
        }
    });

    function validateImageFilename(filename, regId) {
        if (!regId) return;
        
        const expectedFilename = regId.toUpperCase() + '.jpg';
        if (filename !== expectedFilename) {
            imageError.textContent = `Filename should be: ${expectedFilename}`;
            imageError.classList.remove('hidden');
        } else {
            imageError.classList.add('hidden');
        }
    }

    // Form enhancement - auto-calculate overtime rate
    const regularWageInput = document.getElementById('regular_wage');
    const overtimeWageInput = document.getElementById('overtime_wage');
    
    regularWageInput.addEventListener('input', function() {
        if (this.value && !overtimeWageInput.value) {
            overtimeWageInput.value = (parseFloat(this.value) * 1.5).toFixed(2);
        }
    });

    // Validation state tracking
    let validationErrors = {
        first_name: false,
        last_name: false,
        occupation: false,
        reg_id: false,
        regular_wage: false,
        overtime_wage: false,
        regular_hours: false,
        maximum_overtime_hours: false
    };

    // Update submit button state based on validation
    function updateSubmitButton() {
        const submitBtn = document.getElementById('submitBtn');
        const hasErrors = Object.values(validationErrors).some(error => error);
        
        if (hasErrors) {
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            submitBtn.classList.remove('hover:bg-green-600', 'hover:shadow-xl', 'hover:-translate-y-0.5');
        } else {
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            submitBtn.classList.add('hover:bg-green-600', 'hover:shadow-xl', 'hover:-translate-y-0.5');
        }
    }

    // Real-time validation feedback with enforcement
    function addValidationFeedback() {
        // Text field validation (minimal visual feedback)
        ['first_name', 'last_name', 'occupation', 'reg_id'].forEach(fieldId => {
            const field = document.getElementById(fieldId);
            
            field.addEventListener('input', function() {
                const isValid = this.value.length <= 80 && this.value.trim().length > 0;
                validationErrors[fieldId] = !isValid;
                
                // Simple visual feedback - red border for invalid
                if (!isValid) {
                    this.classList.add('border-red-500');
                    this.classList.remove('border-green-500/30');
                } else {
                    this.classList.remove('border-red-500');
                    this.classList.add('border-green-500/30');
                }
                
                updateSubmitButton();
            });
        });

        // Wage validation (minimal visual feedback)
        [regularWageInput, overtimeWageInput].forEach(field => {
            field.addEventListener('input', function() {
                const value = parseFloat(this.value);
                const fieldId = this.id;
                const isValid = value >= 0.01 && value <= 999.99;
                validationErrors[fieldId] = !isValid;
                
                // Simple visual feedback - red border for invalid
                if (!isValid && this.value !== '') {
                    this.classList.add('border-red-500');
                    this.classList.remove('border-green-500/30');
                } else {
                    this.classList.remove('border-red-500');
                    this.classList.add('border-green-500/30');
                }
                
                updateSubmitButton();
            });
        });

        // Hours validation (minimal visual feedback)
        const regularHoursInput = document.getElementById('regular_hours');
        const maxOvertimeInput = document.getElementById('maximum_overtime_hours');
        
        [regularHoursInput, maxOvertimeInput].forEach(field => {
            field.addEventListener('input', function() {
                const value = parseInt(this.value);
                const fieldId = this.id;
                const isRegular = fieldId === 'regular_hours';
                const min = isRegular ? 1 : 0;
                const max = 24;
                const isOptional = fieldId === 'maximum_overtime_hours';
                
                // For optional field, empty value is valid
                const isValid = isOptional ? (this.value === '' || (value >= min && value <= max)) : (value >= min && value <= max);
                validationErrors[fieldId] = !isValid;
                
                // Simple visual feedback - red border for invalid
                if (!isValid && this.value !== '') {
                    this.classList.add('border-red-500');
                    this.classList.remove('border-green-500/30');
                } else {
                    this.classList.remove('border-red-500');
                    this.classList.add('border-green-500/30');
                }
                
                updateSubmitButton();
            });
        });
    }
    
    // Initialize validation feedback
    addValidationFeedback();
});
</script>
  