<!-- Attendance Results Tab Layout -->
<div id="attendance-results" class="flex flex-1 h-full w-full overflow-hidden">
    <!-- Sidebar -->
    <div class="w-64 shrink-0 bg-gray-900 border-r border-green-500/30">
      {% include 'admin/tabs/attendance/attendance_sidebar.html' %}
    </div>
  
    <!-- Content Panel -->
    <div class="flex-1 p-6 overflow-y-auto scrollbar-hide">
      {% include 'admin/tabs/attendance/attendance_content_panel.html' %}
    </div>
  </div>

<!-- Quick Filters JavaScript -->
<script>
// Helper function to update Quick Filter state in forms before submission
function updateQuickFilterStateInForm(formId) {
    const form = document.getElementById(formId);
    if (!form) return;
    
    const showPresentCheckbox = document.getElementById('show-present');
    const showAbsentCheckbox = document.getElementById('show-absent');
    const showIncompleteCheckbox = document.getElementById('show-incomplete');
    
    // Update hidden inputs with current checkbox states
    const presentInput = form.querySelector('input[name="show_present"]');
    const absentInput = form.querySelector('input[name="show_absent"]');
    const incompleteInput = form.querySelector('input[name="show_incomplete"]');
    
    if (presentInput && showPresentCheckbox) {
        presentInput.value = showPresentCheckbox.checked ? 'true' : 'false';
    }
    if (absentInput && showAbsentCheckbox) {
        absentInput.value = showAbsentCheckbox.checked ? 'true' : 'false';
    }
    if (incompleteInput && showIncompleteCheckbox) {
        incompleteInput.value = showIncompleteCheckbox.checked ? 'true' : 'false';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const showPresentCheckbox = document.getElementById('show-present');
    const showAbsentCheckbox = document.getElementById('show-absent');
    const showIncompleteCheckbox = document.getElementById('show-incomplete');
    const attendanceCards = document.querySelectorAll('.attendance-card');
    
    // Restore Quick Filter state from backend/URL parameters
    {% if show_present is defined %}
        if (showPresentCheckbox) showPresentCheckbox.checked = {{ 'true' if show_present else 'false' }};
    {% endif %}
    {% if show_absent is defined %}
        if (showAbsentCheckbox) showAbsentCheckbox.checked = {{ 'true' if show_absent else 'false' }};
    {% endif %}
    {% if show_incomplete is defined %}
        if (showIncompleteCheckbox) showIncompleteCheckbox.checked = {{ 'true' if show_incomplete else 'false' }};
    {% endif %}
    
    function updateCardVisibility() {
        const showPresent = showPresentCheckbox.checked;
        const showAbsent = showAbsentCheckbox.checked;
        const showIncomplete = showIncompleteCheckbox.checked;
        
        let visibleCount = 0;
        
        attendanceCards.forEach(card => {
            const status = card.dataset.status;
            const hasIncomplete = card.dataset.incomplete === 'true';
            
            let shouldShow = false;
            
            // Determine if card should be shown based on filters
            if (status === 'present') {
                if (showIncomplete && !showPresent) {
                    // Only show incomplete checkouts
                    shouldShow = hasIncomplete;
                } else if (showPresent && !showIncomplete) {
                    // Show all present employees
                    shouldShow = true;
                } else if (showPresent && showIncomplete) {
                    // Show all present employees (incomplete filter doesn't restrict when present is on)
                    shouldShow = true;
                } else {
                    // Neither present nor incomplete selected, don't show present employees
                    shouldShow = false;
                }
            } else if (status === 'absent') {
                shouldShow = showAbsent;
            }
            
            if (shouldShow) {
                card.style.display = 'table-row';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // Update the header count if it exists
        const headerElement = document.querySelector('.text-gray-300');
        if (headerElement && headerElement.textContent.includes('Showing')) {
            const dateText = headerElement.textContent.split(' - ')[0];
            headerElement.textContent = `${dateText} - Showing ${visibleCount} employees`;
        }
    }
    
    // Add event listeners to checkboxes
    if (showPresentCheckbox) {
        showPresentCheckbox.addEventListener('change', updateCardVisibility);
    }
    if (showAbsentCheckbox) {
        showAbsentCheckbox.addEventListener('change', updateCardVisibility);
    }
    if (showIncompleteCheckbox) {
        showIncompleteCheckbox.addEventListener('change', updateCardVisibility);
    }
    
    // Initial call to set correct visibility
    updateCardVisibility();
});
</script>